<div class="container my-5">
  <h2 class="title text-center mb-5">VocÃª tem um match!</h2>
    <div class="row">
      <% @matches.sort_by { |match| -match[:match_data][:score] }.first(1).each do |match| %>
        <div class="col-sm-6 mb-4">
          <div class="card-match mx-auto my-auto">
            <div class="position-relative">
              <% if match[:animal].photo.attached? %>
                <%= cl_image_tag match[:animal].photo.key, width: 350, height: 350, crop: :fill %>
              <% else %>
                <%= image_tag "CRMLO.png", width: 350, height: 350 %>
              <% end %>
              <div class="number position-absolute top-0 start-0 d-flex justify-content-center align-items-center p-2">
                <%= (match[:match_data][:score].to_f / 6 * 100).round(0) %>%</div>
            </div>
            <div class="back-caramelo d-flex justify-content-between p-4">
              <div class="animal-preview">
                <h3 class="mb-0"><%= match[:animal].name%></h3>
                <p class="mb-0"><%= match[:animal].city %>/<%= match[:animal].state %></p>
              </div>
              <div class="icons d-flex">
                <%= link_to "<i class=\"fa-solid fa-circle-info\"></i>".html_safe, animal_path(match[:animal].id), class:"info" %>
                <% if current_user.adopter? %>
                  <% if current_user.bookmarks.exists?(animal_id: match[:animal].id) %>
                    <% bookmark = current_user.bookmarks.find_by(animal_id: match[:animal].id) %>
                    <%= button_to "<i class='fa-solid fa-heart red-heart'></i>".html_safe,
                      bookmark_path(bookmark, from_page: "matchs"), method: :delete,
                      style: "background: none; border: none; padding: 0; font: inherit; cursor: pointer;",
                      class: "info ms-1 favorite-button" %>
                  <% else %>
                    <%= button_to "<i class='fa-solid fa-heart'></i>".html_safe,
                      bookmarks_path(from_page: "matchs"), method: :post, params: { bookmark: { animal_id: match[:animal].id } },
                      style: "background: none; border: none; padding: 0; font: inherit; cursor: pointer;",
                      class: "info ms-1 favorite-button" %>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
        <% @animal_match = match[:animal].id  %>
      <% end %>

      <div class="col-sm-6 mb-4">
        <div class="card-match mx-auto my-auto">
          <div class="position-relative">
            <% if current_user.photo.attached? %>
              <%= cl_image_tag current_user.photo.key, class: "user-card", alt: "dropdown menu", height: 350, width: 350 %>
            <% else %>
              <%= image_tag "cat.jpg", class: "user-card", alt: "dropdown menu", height: 350, width: 350 %>
            <% end %>
          </div>
          <div class="back-caramelo d-flex justify-content-between p-4">
            <div class="animal-preview">
              <h3 class="mb-0"><%= current_user.first_name%> <%= current_user.last_name%></h3>
              <p class="mb-0"><%= current_user.city %>/<%= current_user.state %></p>
            </div>
          </div>
        </div>
      </div>
    </div>

  <div class="match-btn mx-auto mt-5">
    <%= link_to "Quero adotar", animal_path(@animal_match), class:"btn-dark-green mb-2 match-btn" %>
    <%= link_to "Ver todos os matches", matchs_path, class:"btn-dark-green-outline match-btn" %>
  </div>
</div>
